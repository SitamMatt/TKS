<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<f:metadata>
    <f:viewParam name="login" value="#{userFormController.login}"/>
    <f:viewAction action="#{userFormController.loadUser}"/>
</f:metadata>
<f:view>
    <h:head>
        <title>#{msg['edit_user']}</title>
    </h:head>
    <body>
    <ui:composition template="/common/templateLayout.xhtml">
        <ui:define name="content">
            <script type="text/javascript">
                function validateForm(){
                    const password = document.getElementById("form:password");
                    const login = document.getElementById("form:login");
                    const pwdStr = "#{msg['password_too_short']}";
                    const loginStr = "#{msg['login_required']}";
                    var resStr = ""
                    if(password.value.length &lt; 8){
                        resStr = resStr.concat(pwdStr, " \n")
                    }
                    if(login.value.length === 0){
                        resStr = resStr.concat(loginStr, " \n")
                    }
                    if (resStr.length > 0){
                        alert(resStr)
                        return false
                    }
                    else {
                        return true
                    }
                }
            </script>
            <h:outputLabel value="#{msg['edit_user']}"/>
            <h:form rendered="#{not empty userFormController.user}" id="form">
                <h:panelGrid columns="2">
                    <h:outputLabel for="firstname" value="#{msg['firstname']}"/>
                    <h:inputText id="firstname" value="#{userFormController.user.firstName}"/>

                    <h:outputLabel for="lastname" value="#{msg['lastname']}"/>
                    <h:inputText id="lastname" value="#{userFormController.user.lastName}"/>

                    <h:outputLabel for="login" value="#{msg['user_login']}:*"
                                   rendered="#{userFormController.user.login == null}"/>
                    <h:inputText id="login" value="#{userFormController.user.login}"
                                 rendered="#{userFormController.user.login == null}"
                                 required="true" requiredMessage="#{msg.login_req}"/>

                    <h:outputLabel for="password" value="#{msg['password']}:*"/>
                    <h:inputSecret id="password" value="#{userFormController.user.password}" redisplay="true"
                                    required="true" requiredMessage="#{msg.pass_req}"/>

                    <h:outputLabel for="type" value="#{msg['type']}"/>
                    <h:selectOneMenu id="type" value="#{userFormController.user.role}">
                        <f:selectItems value="#{userFormController.roles}"/>
                    </h:selectOneMenu>

                    <h:outputLabel for="active" value="#{msg['active']}"/>
                    <h:selectBooleanCheckbox id="active" value="#{userFormController.user.active}"/>

                    <h:commandButton value="#{msg['back']}" action="usersList"/>

                    <h:commandButton value="#{msg['submit']}" onclick="return validateForm()" action="#{userFormController.saveUser}"
                                     binding="#{userFormController.btn}">
                        <h:outputScript library="js" name="confirm.js" />
                        <f:setPropertyActionListener target="#{userFormController.login}"
                                                     value="#{userFormController.user.login}"/>
                    </h:commandButton>
                </h:panelGrid>
            </h:form>
        </ui:define>
    </ui:composition>
    </body>
</f:view>
</html>
